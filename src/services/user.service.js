// import utilService from './util.service.js'

import storageService from './storage.service.js'

const KEY = 'usersAppKey';

// When app is loaded - init our initial storage
(() => {
    if (!localStorage[KEY]) {
        localStorage[KEY] = JSON.stringify({userName: 'Rick', 
                                            img: "data:image/jpeg;base64,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", 
                                            actions: [{name: 'Add to do', at: (new Date()).getTime()}]})
    }
})();


function query() {
    return storageService.load(KEY)
        .then(user => {
            return user;
        })
}

function saveUser(user) {
    storageService.store(KEY, user);
    return Promise.resolve(user);
}

function addAction(action){
    return storageService.load(KEY)
        .then(user => {
            user.actions.unshift({name: action, at: (new Date()).getTime()})
            storageService.store(KEY, user);
            return Promise.resolve(user);
        })
}

export default {
    query,
    saveUser,
    addAction
}

